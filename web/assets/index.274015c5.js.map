{"version":3,"file":"index.274015c5.js","sources":["../../vite/modulepreload-polyfill","../../addressforall.js","../../main.js"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","const olKey =\n  \"pk.eyJ1IjoiZWxwYmF0aXN0YSIsImEiOiJja3gyZHl5OXYxbm5yMnFxOTFtZWhqbWlhIn0.bbHJjnHrt_d9iqu4hBZgyw\";\nconst markerBlue = \"../img/map-marker-blue-32.png\";\nconst markerOrange = \"../img/map-marker-orange-32.png\";\nconst mapCenter = [-75.595483, 6.269356];\n\nconst APIURL = \"http://api.addressforall.org/test/_sql/rpc/\";\nconst API = {\n  search: APIURL + \"search\",\n  search_bounded: APIURL + \"search_bounded\",\n};\n\nexport default API;\nexport { olKey, mapCenter, markerBlue, markerOrange };\n\n// http://api.addressforall.org/test/get_centroid?","import API, {\n  mapCenter,\n  olKey as key,\n  markerBlue,\n  markerOrange,\n} from \"./addressforall.js\";\nimport \"./style.css\";\nimport \"ol/ol.css\";\nimport Map from \"ol/Map\";\nimport View from \"ol/View\";\nimport { Tile as TileLayer, Vector as VectorLayer } from \"ol/layer\";\nimport { XYZ as XYZ, Vector as VectorSource } from \"ol/source\";\nimport { Attribution, defaults as defaultControls } from \"ol/control\";\nimport { Icon, Style } from \"ol/style\";\nimport GeoJSON from \"ol/format/GeoJSON\";\n\n// import { useGeographic } from \"ol/proj\";\n// useGeographic();\n\nimport $ from \"jquery\";\nimport mark from \"mark.js/dist/jquery.mark.js\";\nimport { clearAllProjections } from \"ol/proj\";\nwindow.jQuery = window.$ = $;\n\nconst attribution = new Attribution({\n  collapsible: false,\n});\n\nconst icon = new Style({\n  image: new Icon({\n    anchor: [0.5, 31],\n    anchorXUnits: \"fraction\",\n    anchorYUnits: \"pixels\",\n    src: markerBlue,\n  }),\n  // text: new Text({\n  //   text: getText,\n  //   font: \"11px\",\n  //   fill: new Fill({ color: \"rgba(52, 102, 180, 1)\" }),\n  //   stroke: new Stroke({ color: \"rgba(46, 44, 42, 0.5)\", width: .5 }),\n  //   textAlign: \"center\",\n  //   offsetY: -20,\n  // }),\n});\n\nconst selectedIcon = new Style({\n  image: new Icon({\n    anchor: [0.5, 31],\n    anchorXUnits: \"fraction\",\n    anchorYUnits: \"pixels\",\n    src: markerOrange,\n  }),\n  // text: new Text({\n  //   text: getText,\n  //   font: \"11px\",\n  //   fill: new Fill({ color: \"rgba(52, 102, 180, 1)\" }),\n  //   stroke: new Stroke({ color: \"rgba(46, 44, 42, 0.5)\", width: .5 }),\n  //   textAlign: \"center\",\n  //   offsetY: -20,\n  // }),\n});\n\n// const scaleBar = new ScaleLine({\n//   units: \"metric\",\n//   bar: true,\n//   steps: 4,\n//   text: true,\n//   minWidth: 140,\n// });\n\nconst baseMap = new TileLayer({\n  source: new XYZ({\n    attributions:\n      '© <a href=\"https://www.mapbox.com/map-feedback/\">Mapbox</a> ' +\n      '© <a href=\"https://www.openstreetmap.org/copyright\">' +\n      \"OpenStreetMap contributors</a>\",\n    url:\n      \"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=\" +\n      key,\n  }),\n});\n\nconst addresses = new VectorLayer({\n  style: icon,\n});\n\nconst map = new Map({\n  controls: defaultControls({ attribution: false }).extend([attribution]),\n  target: \"map\",\n  layers: [baseMap, addresses],\n  view: new View({\n    projection: \"EPSG:4326\",\n    center: mapCenter,\n    zoom: 15,\n  }),\n});\n\n// map.addControl(scaleBar);\n\nconst searchBounded = (term, boundingBox) => {\n  $.ajax({\n    url: API.search_bounded,\n    type: \"POST\",\n    processData: false,\n    contentType: \"application/json\",\n    cache: true,\n    jsonp: false,\n    data: JSON.stringify({\n      _q: term,\n      viewbox: boundingBox,\n      lim: 1000,\n    }),\n    dataType: \"json\",\n    crossDomain: true,\n    success: function (data) {\n      if (data.features) {\n        // clear map\n        addresses.setSource(null);\n        // plot search results\n        addresses.setSource(\n          new VectorSource({\n            features: new GeoJSON().readFeatures(data),\n          })\n        );\n        let result = data.features.map(\n          (feature) =>\n            '<li id=\"' +\n            feature.properties._id +\n            '\" class=\"feature list-group-item d-flex justify-content-between align-items-start\"  data-coordinates=\"' +\n            JSON.stringify(feature.geometry.coordinates) +\n            '\">' +\n            '<div class=\"ms-2 me-auto\">' +\n            '<div class=\"address fw-bold\">' +\n            feature.properties.address +\n            \"</div>\" +\n            '<div class=\"display_name fw-lighter\">' +\n            feature.properties.display_name +\n            \" \" +\n            feature.properties.barrio +\n            // \" \" +\n            // feature.properties.comuna +\n            \"</div>\" +\n            \"</div>\" +\n            '<span class=\"badge bg-info bg-opacity-85 rounded-pill\">' +\n            Math.round(feature.properties.similarity * 100) +\n            \"%\" +\n            \"</span>\" +\n            \"</li>\"\n        );\n        // show results\n        $(\"#search\").removeClass(\"is-invalid\");\n        $(\"#afo-results\").show();\n        $(\"#clear-btn\").show();\n        $(\"#afo-results\").children(\"ul\").empty().show();\n        // populate the list\n        $(\"#afo-results\").children(\"ul\").append(result);\n        // highlight matching words\n        $(\".display_name\").mark(term.split(\" \"));\n      } else {\n        $(\"#search\").addClass(\"is-invalid\");\n        clearResults();\n      }\n    },\n  });\n};\n\nconst search = (e) => {\n  let searchBox = $(e.target);\n  e.stopPropagation();\n  clearTimeout(searchBox.data(\"timeout\"));\n  searchBox.data(\n    \"timeout\",\n    setTimeout(function () {\n      let term = searchBox.val();\n      if (term.length >= 3) {\n        searchBounded(term, map.getView().calculateExtent(map.getSize()));\n      }\n    }, 200)\n  );\n};\n\n$(\"#search\").on(\"keyup\", function (e) {\n  search(e);\n});\n\n$(document).on(\"keydown\", \"form\", function (event) {\n  return event.key != \"Enter\";\n});\n\n$(document).on(\"click\", \"#clear-btn\", function (e) {\n  e.stopPropagation();\n  e.stopImmediatePropagation();\n  clearResults();\n  $(\"#search\").val(\"\");\n  map.getView().setZoom(15);\n  $(e.currentTarget).hide();\n  return false;\n});\n\n$(document).on(\"click\", \".feature\", function (e) {\n  e.stopPropagation();\n  e.stopImmediatePropagation();\n\tlet currentItem = $(e.currentTarget);\n\tlet view = map.getView();\n  let coordinates = JSON.parse(currentItem.attr(\"data-coordinates\"));\n  let selectedFeature = addresses\n    .getSource()\n    .getClosestFeatureToCoordinate(coordinates);\n  selectedFeature.setStyle(selectedIcon);\n  view.setCenter(coordinates);\n  view.setZoom(20);\n  currentItem.addClass(\"selected\");\n});\n\nconst clearResults = () => {\n  addresses.setSource(null);\n  $(\"#afo-results\").children(\"ul\").empty().hide();\n};\n"],"names":["key","defaultControls"],"mappings":"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"}